(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{B2hK:function(e,t,r){"use strict";r.r(t);var n=r("hosL"),a=r("co3k"),o=r("z4Qk"),i=r("qoM+"),l=r("jdJj"),u=r("PyG4"),c=r("fsQa"),s=r("qYlV"),d=r.n(s);function p(){return(p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function m(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}function f(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return h(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return h(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var O=c.a.t("Need help?"),y=c.a.t("Please, tell us some information to start the chat"),j=function(e){return void 0===e&&(e=[]),1===e.length&&e[0]._id||""},w={name:[i.e.nonEmpty],email:[i.e.nonEmpty,i.e.email],department:[]},F=function(e){return Object.keys(w).map((function(t){return e[t]?v({fieldName:t},e[t]):null})).filter(Boolean)},P=function(e,t){var r,n,a=t.name,o=t.value,l=t.regexp;return(w[a]||(r=e,n=r.customFields,(void 0===n?[]:n).map((function(e){var t,r=e._id,n=e.required,a=e.regexp,o=[];return n&&o.push(i.e.nonEmpty),a&&o.push(i.e.custom),(t={})[r]=o,t})).reduce((function(e,t){return v(v({},e),t)}),{}))[a]).reduce((function(e,t){return e||t({value:o,pattern:l})}),void 0)},D=function(e){var t=e.hasNameField,r=e.hasEmailField,n=e.hasDepartmentField,a=e.departments,o=e.customFields,i=void 0===o?[]:o,l=v(v(v({},t&&{name:{value:""}}),r&&{email:{value:""}}),n&&{department:{value:j(a)}});i.forEach((function(e){var t=e._id,r=e.defaultValue,n=e.options,a=e.regexp,o="";(r&&!n||Array.isArray(n)&&n.includes(r))&&(o=r),l[t]=v({value:o},a&&{regexp:a})}));for(var u,c=f(F(l));!(u=c()).done;){var s,d=u.value,p=d.fieldName,m=d.value,h=d.regexp,b=P(e,{name:p,value:m,regexp:h});l=v(v({},l),{},((s={})[p]=v(v({},l[p]),{},{value:m,error:b,showError:!1}),s))}return l},E=function(e){var t,r;function s(t){var r;return(r=e.call(this,t)||this).state={name:null,email:null,department:null},r.handleFieldChange=function(e){var t,n=e.target,a=n.name,o=n.value,i=r.state[a].regexp,l=P(r.props,{name:a,value:o,regexp:i});r.setState(((t={})[a]=v(v({},r.state[a]),{},{value:o,error:l,showError:!0}),t))},r.handleSubmit=function(e){if(e.preventDefault(),r.props.onSubmit){var t=Object.entries(r.state).filter((function(e){return null!==e[1]})).map((function(e){var t,r=e[0],n=e[1].value;return(t={})[r]=n,t})).reduce((function(e,t){return v(v({},e),t)}),{});r.props.onSubmit(t)}},r.state=D(t),r}return r=e,(t=s).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,s.getDerivedStateFromProps=function(e,t){var r=e.hasNameField,n=e.hasEmailField,a=e.hasDepartmentField,o=e.departmentDefault,i=e.departments,l=e.nameDefault,u=e.emailDefault,c=l||"";!r||t.name&&t.name===c?r||(t=v(v({},t),{},{name:null})):t=v(v({},t),{},{name:v(v({},t.name),{},{value:c})});var s=u||"";!n||t.email&&t.name===s?n||(t=v(v({},t),{},{email:null})):t=v(v({},t),{},{email:v(v({},t.email),{},{value:s})});var d=o||j(i),p=a&&i&&i.length>1;!p||t.department&&t.department===d?p||(t=v(v({},t),{},{department:null})):t=v(v({},t),{},{department:v(v({},t.department),{},{value:d})});for(var m,h=f(F(t));!(m=h()).done;){var b,g=m.value,O=g.fieldName,y=g.value,w=g.regexp,D=P(e,{name:O,value:y,regexp:w});t=v(v({},t),{},((b={})[O]=v(v({},t[O]),{},{value:y,error:D,showError:!1}),b))}},s.prototype.render=function(e,t){var r=t.name,s=t.email,f=t.department,h=m(t,["name","email","department"]),b=e.title,v=e.color,g=e.message,j=e.loading,w=e.departments,P=e.customFields,D=m(e,["title","color","message","loading","departments","customFields"]),E=F(this.state).every((function(e){return!(void 0===e?{}:e).error}));return Object(n.h)(l.b,p({color:v,title:b||O,className:Object(u.d)(d.a,"register")},D),Object(n.h)(l.b.Content,null,Object(n.h)("p",{className:Object(u.d)(d.a,"register__message")},g||y),Object(n.h)(i.a,{onSubmit:this.handleSubmit},r?Object(n.h)(i.b,{required:!0,label:c.a.t("Name"),error:r.showError&&r.error},Object(n.h)(i.d,{name:"name",value:r.value,placeholder:c.a.t("Insert your %{field} here...",{field:c.a.t("Name")}),disabled:j,onInput:this.handleFieldChange})):null,s?Object(n.h)(i.b,{required:!0,label:c.a.t("Email"),error:s.showError&&s.error},Object(n.h)(i.d,{name:"email",value:s.value,placeholder:c.a.t("Insert your %{field} here...",{field:c.a.t("Email")}),disabled:j,onInput:this.handleFieldChange})):null,f?Object(n.h)(i.b,{label:c.a.t("I need help with..."),error:f.showError&&f.error},Object(n.h)(i.c,{name:"department",value:f.value,options:Object(u.o)(w,"name").map((function(e){return{value:e._id,label:e.name}})),placeholder:c.a.t("Choose an option..."),disabled:j,onInput:this.handleFieldChange})):null,P&&function(e,t,r){var a=t.loading,o=t.handleFieldChange,l=void 0===o?function(){}:o;return e.map((function(e){var t=e._id,o=e.required,u=e.label,s=e.type,d=e.options;switch(s){case"input":return Object(n.h)(i.b,{label:u,required:o,key:t,error:r[t].showError&&r[t].error},Object(n.h)(i.d,{name:t,placeholder:c.a.t("Insert your %{field} here...",{field:u}),value:r[t].value,disabled:a,onInput:l,custom:!0}));case"select":return Object(n.h)(i.b,{label:u,required:o,key:t,error:r[t].showError&&r[t].error},Object(n.h)(i.c,{name:t,value:r[t].value,placeholder:c.a.t("Choose an option..."),options:d&&d.map((function(e){return{value:e,label:e}})),disabled:a,onInput:l,custom:!0}))}return null}))}(P,{loading:j,handleFieldChange:this.handleFieldChange},h),Object(n.h)(o.a,null,Object(n.h)(a.a,{submit:!0,loading:j,disabled:!E||j,stack:!0},c.a.t("Start chat"))))),Object(n.h)(l.b.Footer,null))},s}(n.Component),C=r("Y3FI"),S=r("qPgm"),k=r("SvlM"),_=r("vBLd"),x=r("kQFM");function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function N(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?N(Object(r),!0).forEach((function(t){A(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function R(e,t){if(null==e)return{};var r,n,a={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(a[r]=e[r]);return a}var M=function(e){var t,r;function a(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(t=e.call.apply(e,[this].concat(a))||this).getDepartment=function(e){if(""!==e)return e;var r=t.props.departments,n=(void 0===r?{}:r).find((function(e){return e.showOnRegistration}));return n?n._id:void 0},t.handleSubmit=function(e){return new Promise((function(r,n){var a,o,i,l,u,c,s,d,p,m=function(e){return function(t){try{return Promise.resolve(c({loading:!1})).then(function(r){try{return e&&e.call(this,t)}catch(e){return n(e)}}.bind(this),n)}catch(e){return n(e)}}.bind(this)}.bind(this);return a=e.name,o=e.email,i=e.department,l=R(e,["name","email","department"]),u=t.props,c=u.dispatch,s=u.token,d={name:a,email:o,department:t.getDepartment(i)},Promise.resolve(c({loading:!0,department:i})).then((function(e){try{var a=function(){try{return r()}catch(e){return n(e)}},o=function(e){try{throw e}catch(e){return m(n)(e)}};try{return Promise.resolve(S.a.grantVisitor({visitor:q(q({},d),{},{token:s})})).then((function(e){try{return p=e,Promise.resolve(c({user:p})).then((function(e){try{return Object(_.a)("callback",["pre-chat-form-submit",d]),t.registerCustomFields(l),m(a)()}catch(e){return o(e)}}),o)}catch(e){return o(e)}}),o)}catch(e){o(e)}}catch(e){return n(e)}}),n)}))},t.render=function(e){return Object(n.h)(E,I({},e,{onSubmit:t.handleSubmit,departmentDefault:t.getDepartmentDefault()}))},t}r=e,(t=a).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r;var o=a.prototype;return o.registerCustomFields=function(e){void 0===e&&(e={}),Object.entries(e).forEach((function(e){var t=e[0],r=e[1];r&&""!==r&&k.a.setCustomField(t,r,!0)}))},o.getDepartmentDefault=function(){var e=this.props,t=e.guestDepartment,r=e.departments;if(r&&r.some((function(e){return e._id===t})))return t},o.componentDidUpdate=function(e){var t=e.user,r=this.props.user;!t&&r&&r._id&&Object(C.b)("/")},a}(n.Component),B=function(e){var t=e.ref,r=R(e,["ref"]);return Object(n.h)(x.a,null,(function(e){var a=e.config,o=(a=void 0===a?{}:a).departments,i=void 0===o?{}:o,l=a.messages,u=(l=void 0===l?{}:l).registrationFormMessage,c=a.settings,s=(c=void 0===c?{}:c).nameFieldRegistrationForm,d=c.emailFieldRegistrationForm,p=a.theme,m=(p=void 0===p?{}:p).title,f=p.color,h=a.customFields,b=void 0===h?[]:h,v=e.iframe,g=(v=void 0===v?{}:v).guest,O=(g=void 0===g?{}:g).department,y=g.name,j=g.email,w=v.theme,F=(w=void 0===w?{}:w).color,P=w.fontColor,D=w.iconColor,E=w.title,C=e.loading,S=void 0!==C&&C,k=e.token,_=e.dispatch,x=e.user;return Object(n.h)(M,I({ref:t},r,{theme:{color:F||f,fontColor:P,iconColor:D,title:E},title:E||m,message:u,hasNameField:s,hasEmailField:d,hasDepartmentField:i&&i.some((function(e){return e.showOnRegistration})),departments:i.filter((function(e){return e.showOnRegistration})),nameDefault:y,emailDefault:j,guestDepartment:O,loading:S,token:k,dispatch:_,user:x,customFields:b}))}))},J=B;r.d(t,"Register",(function(){return E})),r.d(t,"RegisterContainer",(function(){return M})),r.d(t,"RegisterConnector",(function(){return B})),r.d(t,"default",(function(){return J}))}}]);
//# sourceMappingURL=route-Register.chunk.af935.js.map