(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{EZ5h:function(e,t,n){"use strict";(function(e,r){n.d(t,"a",function(){return E});var o=n("gDde"),i=n("RNH9"),a=n("XMrS"),s=n("U5IY"),c=n("Fl18"),u=n("/4k+"),l=n("cVMQ"),h=n("jdJj"),d=n("PyG4"),f=n("/1Qh"),m=n.n(f),p=n("eanU"),g=n.n(p),v=n("gxdA"),y=n.n(v),b=n("ajAD"),P=n.n(b),w=n("Eo3F"),j=n.n(w),C=n("DkJZ"),O=n.n(C),S=n("2Wrb"),k=n.n(S);n("u37h");function D(){return(D=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function T(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var R=e(k.a,{width:20}),U=e(P.a,{width:20}),M=e(O.a,{width:20}),E=function(t){var n,o;function f(){for(var n,o=arguments.length,f=new Array(o),p=0;o>p;p++)f[p]=arguments[p];return A(T(n=t.call.apply(t,[this].concat(f))||this),"state",{atBottom:!0,text:"",emojiPickerActive:!1}),A(T(n),"handleFilesDropTargetRef",function(e){n.filesDropTarget=e}),A(T(n),"handleMessagesContainerRef",function(e){n.messagesContainer=e?e.base:null}),A(T(n),"handleScrollTo",function(e){var t=n.props,r=t.onTop,o=t.onBottom;if(e===l.a.SCROLL_AT_BOTTOM)return n.setState({atBottom:!0}),void(o&&o());n.setState({atBottom:!1}),e===l.a.SCROLL_AT_TOP&&r&&r()}),A(T(n),"handleUploadClick",function(e){e.preventDefault(),n.filesDropTarget.browse()}),A(T(n),"handleSendClick",function(e){e.preventDefault(),n.handleSubmit(n.state.text)}),A(T(n),"handleSubmit",function(e){n.props.onSubmit&&(n.props.onSubmit(e),n.setState({text:""}),n.turnOffEmojiPicker())}),A(T(n),"handleChangeText",function(e){n.setState({text:e});var t=n.props.onChangeText;t&&t(e)}),A(T(n),"toggleEmojiPickerState",function(){n.setState({emojiPickerActive:!n.state.emojiPickerActive})}),A(T(n),"handleEmojiSelect",function(e){n.toggleEmojiPickerState(),n.notifyEmojiSelect(e.native)}),A(T(n),"handleEmojiClick",function(){n.turnOffEmojiPicker()}),A(T(n),"turnOffEmojiPicker",function(){n.state.emojiPickerActive&&n.setState({emojiPickerActive:!n.state.emojiPickerActive})}),A(T(n),"render",function(t,o){var f=o.atBottom,p=void 0===f||f,v=o.text,b=t.color,P=t.title,w=t.fontColor,C=t.uid,O=t.agent,S=t.typingUsernames,k=t.avatarResolver,T=t.conversationFinishedMessage,A=t.loading,E=t.onUpload,F=t.messages,_=t.uploads,x=void 0!==_&&_,I=t.options,L=t.onChangeDepartment,q=t.onFinishChat,Q=t.onRemoveUserData,W=t.lastReadMessageId,z=t.queueInfo,B=t.resetLastAction,N=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;i.length>r;r++)0>t.indexOf(n=i[r])&&(o[n]=e[n]);return o}(t,["color","title","fontColor","uid","agent","typingUsernames","avatarResolver","conversationFinishedMessage","loading","onUpload","messages","uploads","options","onChangeDepartment","onFinishChat","onRemoveUserData","lastReadMessageId","queueInfo","resetLastAction"]);return e(h.a,D({color:b,title:P||r.t("Need help?"),fontColor:w,agent:O||null,queueInfo:z,nopadding:!0,onChangeDepartment:L,onFinishChat:q,onRemoveUserData:Q,className:Object(d.d)(m.a,"chat"),handleEmojiClick:n.handleEmojiClick},N),e(s.a,{ref:n.handleFilesDropTargetRef,overlayed:!0,overlayText:r.t("Drop here to upload a file"),onUpload:E},e(h.a.Content,{nopadding:!0},e("div",{className:Object(d.d)(m.a,"chat__messages",{atBottom:p,loading:A})},e(l.a,{ref:n.handleMessagesContainerRef,avatarResolver:k,uid:C,messages:F,typingUsernames:S,conversationFinishedMessage:T,lastReadMessageId:W,onScrollTo:n.handleScrollTo,resetLastAction:B,handleEmojiClick:n.handleEmojiClick}),n.state.emojiPickerActive&&e(i.a,{style:{position:"absolute",zIndex:10,bottom:0,maxWidth:"90%",left:20,maxHeight:"90%"},showPreview:!1,showSkinTones:!1,sheetSize:64,onSelect:n.handleEmojiSelect,autoFocus:!0}))),e(h.a.Footer,{options:I?e(c.c,null,e(u.a.Group,null,L&&e(u.a.Item,{onClick:L,icon:g.a},r.t("Change department")),Q&&e(u.a.Item,{onClick:Q,icon:j.a},r.t("Forget/Remove my data")),q&&e(u.a.Item,{danger:!0,onClick:q,icon:y.a},r.t("Finish this chat")))):null},e(a.a,{onUpload:E,onSubmit:n.handleSubmit,onChange:n.handleChangeText,placeholder:r.t("Type your message here"),value:v,notifyEmojiSelect:function(e){n.notifyEmojiSelect=e},handleEmojiClick:n.handleEmojiClick,pre:e(a.c,null,e(a.b,{onClick:n.toggleEmojiPickerState},R)),post:e(a.c,null,0===v.length&&x&&e(a.b,{onClick:n.handleUploadClick},U),v.length>0&&e(a.b,{onClick:n.handleSendClick},M))}))))}),n}return o=t,(n=f).prototype=Object.create(o.prototype),n.prototype.constructor=n,n.__proto__=o,f}(o.Component)}).call(this,n("gDde").h,n("fsQa").default)},mvzb:function(e,t,n){"use strict";(function(e,r){n.d(t,"b",function(){return j}),n.d(t,"a",function(){return C});var o=n("gDde"),i=n("Y3FI"),a=n("qPgm"),s=n("kQFM"),c=n("UEyv"),u=n("vBLd"),l=n("YSmr"),h=n("PyG4"),d=n("EZ5h"),f=n("81xT"),m=n("Saaw"),p=n("qoWs");function g(){return(g=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function v(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;i.length>r;r++)0>t.indexOf(n=i[r])&&(o[n]=e[n]);return o}function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function b(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach(function(t){w(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function P(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var j=function(t){var n,o;function s(){for(var n,o=arguments.length,s=new Array(o),l=0;o>l;l++)s[l]=arguments[l];return w(P(n=t.call.apply(t,[this].concat(s))||this),"state",{room:null,connectingAgent:!1,queueSpot:0,triggerQueueMessage:!0,estimatedWaitTime:null}),w(P(n),"checkConnectingAgent",function(){return new Promise(function(e,t){var r,o,i,a,s,c,u;if(a=n.state,s=o=(r=n.props).connecting,c=(i=r.queueInfo)&&i.spot||0,u=i&&i.estimatedWaitTimeSeconds,s!==a.connectingAgent||c!==a.queueSpot||u!==a.estimatedWaitTime)return n.state.connectingAgent=s,n.state.queueSpot=c,n.state.estimatedWaitTime=u,Promise.resolve(n.handleQueueMessage(o,i)).then(function(){try{return Promise.resolve(n.handleConnectingAgentAlert(s,Object(p.b)(i))).then(function(){try{return l.call(this)}catch(e){return t(e)}}.bind(this),t)}catch(e){return t(e)}}.bind(this),t);function l(){return e()}return l.call(this)})}),w(P(n),"checkRoom",function(){var e=n.props.room,t=n.state.room;!e||t&&e._id===t._id||(n.state.room=e,setTimeout(m.e,500))}),w(P(n),"grantUser",function(){return new Promise(function(e,t){var r,o,i,s,c,u;return o=(r=n.props).token,s=r.guest,c=r.dispatch,(i=r.user)?e(i):(u=b({token:o},s),Promise.resolve(a.a.grantVisitor({visitor:u})).then(function(n){try{return Promise.resolve(c({user:n})).then(function(){try{return e()}catch(e){return t(e)}},t)}catch(e){return t(e)}},t))})}),w(P(n),"getRoom",function(){return new Promise(function(t,r){var o,i,s,c,l,d,f,p,g,v,y=function(e){return function(t){try{return Promise.resolve(s({loading:!1})).then(function(){try{return e&&e.call(this,t)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this)}.bind(this);return i=(o=n.props).alerts,s=o.dispatch,c=o.room,l=o.messages,d=Object(m.c)(l),c?t(c):Promise.resolve(s({loading:!0})).then(function(){try{var n=function(t){try{return g=t.data.error,v={id:Object(h.e)(),children:e.t("Error starting a new conversation: %{reason}",{reason:g}),error:!0,timeout:1e4},Promise.resolve(s({loading:!1,alerts:(i.push(v),i)})).then(function(){try{throw Object(u.b)(g),t}catch(e){return r(e)}},r)}catch(e){return y(r)(e)}};try{return f=Object(m.b)(),Promise.resolve(a.a.room(f)).then(function(e){try{return p=e,Promise.resolve(s({room:p,messages:d,noMoreMessages:!1})).then(function(){try{return Promise.resolve(Object(m.d)()).then(function(){try{return Object(u.a)("callback","chat-started"),y(t)(p)}catch(e){return n(e)}},n)}catch(e){return n(e)}},n)}catch(e){return n(e)}},n)}catch(e){n(e)}}catch(e){return r(e)}},r)})}),w(P(n),"handleTop",function(){Object(m.f)()}),w(P(n),"startTyping",Object(h.o)(function(e){return new Promise(function(t,r){var o,i;return o=e.rid,i=e.username,Promise.resolve(a.a.notifyVisitorTyping(o,i,!0)).then(function(){try{return n.stopTypingDebounced({rid:o,username:i}),t()}catch(e){return r(e)}},r)})},4500)),w(P(n),"stopTyping",function(e){return a.a.notifyVisitorTyping(e.rid,e.username,!1)}),w(P(n),"stopTypingDebounced",Object(h.f)(n.stopTyping,5e3)),w(P(n),"handleChangeText",function(){return new Promise(function(e){var t=n.props,r=t.user,o=t.room;return r&&r.username&&o&&o._id?(n.startTyping({rid:o._id,username:r.username}),e()):e()})}),w(P(n),"resetLastAction",function(){var e=n.props;(0,e.dispatch)({messages:e.messages.map(function(e){return e.actionsVisible&&(e.actionsVisible=!1),e})})}),w(P(n),"handleSubmit",function(e){return new Promise(function(t,r){var o,i,s,c,u,l,d,f;return""===e.trim()?t():Promise.resolve(n.grantUser()).then(function(){try{return Promise.resolve(n.getRoom()).then(function(m){try{o=m._id,s=(i=n.props).alerts,c=i.dispatch,u=i.token,l=i.user;var p=function(){try{return Promise.resolve(a.a.notifyVisitorTyping(o,l.username,!1)).then(function(){try{return t()}catch(e){return r(e)}},r)}catch(e){return r(e)}},g=function(e){try{return d=e.data.error,f={id:Object(h.e)(),children:d,error:!0,timeout:5e3},Promise.resolve(c({alerts:(s.push(f),s)})).then(function(){try{return p()}catch(e){return r(e)}},r)}catch(e){return r(e)}};try{return n.stopTypingDebounced.stop(),n.resetLastAction(),Promise.resolve(Promise.all([n.stopTyping({rid:o,username:l.username}),a.a.sendMessage({msg:e,token:u,rid:o})])).then(function(){try{return p()}catch(e){return g(e)}},g)}catch(e){g(e)}}catch(e){return r(e)}},r)}catch(e){return r(e)}},r)})}),w(P(n),"doFileUpload",function(t,r){return new Promise(function(o,i){var s,c,u,l,d,f,m,p;c=(s=n.props).alerts,u=s.dispatch;var g=function(){try{return o()}catch(e){return i(e)}},v=function(t){try{switch(d=(l=t.data).reason,f=l.sizeAllowed,m=e.t("FileUpload Error"),d){case"error-type-not-allowed":m=e.t("Media Types Not Accepted.");break;case"error-size-not-allowed":m=e.t("File exceeds allowed size of %{size}.",{size:f})}return p={id:Object(h.e)(),children:m,error:!0,timeout:5e3},Promise.resolve(u({alerts:(c.push(p),c)})).then(function(){try{return g()}catch(e){return i(e)}},i)}catch(e){return i(e)}};try{return Promise.resolve(a.a.uploadFile({rid:t,file:r})).then(function(){try{return g()}catch(e){return v(e)}},v)}catch(e){v(e)}})}),w(P(n),"handleUpload",function(e){return new Promise(function(t,r){var o;return Promise.resolve(n.grantUser()).then(function(){try{return Promise.resolve(n.getRoom()).then(function(i){try{return o=i._id,e.forEach(function(e){return n.doFileUpload(o,e)}),t()}catch(e){return r(e)}},r)}catch(e){return r(e)}},r)})}),w(P(n),"handleSoundStop",function(){return new Promise(function(e,t){var r,o;return o=(r=n.props).sound,Promise.resolve((0,r.dispatch)({sound:b({},void 0===o?{}:o,{play:!1})})).then(function(){try{return e()}catch(e){return t(e)}},t)})}),w(P(n),"onChangeDepartment",function(){Object(i.b)("/switch-department")}),w(P(n),"onFinishChat",function(){return new Promise(function(t,r){var o,i,s,c,u,l,d=function(e){return function(t){try{return Promise.resolve(s({loading:!1})).then(function(){try{return Promise.resolve(Object(m.a)()).then(function(){try{return e&&e.call(this,t)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this)}.bind(this);return Promise.resolve(f.a.confirm({text:e.t("Are you sure you want to finish this chat?")})).then(function(f){try{return f.success?(i=(o=n.props).alerts,s=o.dispatch,u=(c=void 0===(c=o.room)?{}:c)._id,Promise.resolve(s({loading:!0})).then(function(){try{var n=function(){try{return t()}catch(e){return r(e)}},o=function(){try{return l={id:Object(h.e)(),children:e.t("Error closing chat."),error:!0,timeout:0},Promise.resolve(s({alerts:(i.push(l),i)})).then(function(){try{return d(n)()}catch(e){return r(e)}},r)}catch(e){return d(r)(e)}};try{if(u)return Promise.resolve(a.a.closeChat({rid:u})).then(function(){try{return c.call(this)}catch(e){return o()}}.bind(this),o);function c(){return d(n)()}return c.call(this)}catch(e){o()}}catch(e){return r(e)}}.bind(this),r)):t()}catch(e){return r(e)}}.bind(this),r)})}),w(P(n),"onRemoveUserData",function(){return new Promise(function(t,r){var o,s,u,l,d=function(e){return function(t){try{return Promise.resolve(Object(c.a)()).then(function(){try{return Promise.resolve(u({loading:!1})).then(function(){try{return Object(i.b)("/chat-finished"),e&&e.call(this,t)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this),r)}catch(e){return r(e)}}.bind(this)}.bind(this);return Promise.resolve(f.a.confirm({text:e.t("Are you sure you want to remove all of your personal data?")})).then(function(i){try{return i.success?(s=(o=n.props).alerts,u=o.dispatch,Promise.resolve(u({loading:!0})).then(function(){try{var n=function(){try{return t()}catch(e){return r(e)}},o=function(){try{return l={id:Object(h.e)(),children:e.t("Error removing user data."),error:!0,timeout:0},Promise.resolve(u({alerts:(s.push(l),s)})).then(function(){try{return d(n)()}catch(e){return r(e)}},r)}catch(e){return d(r)(e)}};try{return Promise.resolve(a.a.deleteVisitor()).then(function(){try{return d(n)()}catch(e){return o()}},o)}catch(e){o()}}catch(e){return r(e)}},r)):t()}catch(e){return r(e)}},r)})}),w(P(n),"canSwitchDepartment",function(){var e=n.props,t=e.departments;return e.allowSwitchingDepartments&&(void 0===t?{}:t).filter(function(e){return e.showOnRegistration}).length>1}),w(P(n),"canFinishChat",function(){var e=n.props;return void 0!==e.room||e.connecting}),w(P(n),"canRemoveUserData",function(){return n.props.allowRemoveUserData}),w(P(n),"showOptionsMenu",function(){return n.canSwitchDepartment()||n.canFinishChat()||n.canRemoveUserData()}),w(P(n),"render",function(e){var t=e.user,o=v(e,["user"]);return r(d.a,g({},o,{avatarResolver:h.h,uid:t&&t._id,onTop:n.handleTop,onChangeText:n.handleChangeText,onSubmit:n.handleSubmit,onUpload:n.handleUpload,options:n.showOptionsMenu(),onChangeDepartment:n.canSwitchDepartment()&&n.onChangeDepartment||null,onFinishChat:n.canFinishChat()&&n.onFinishChat||null,onRemoveUserData:n.canRemoveUserData()&&n.onRemoveUserData||null,onSoundStop:n.handleSoundStop,resetLastAction:n.resetLastAction}))}),n}o=t,(n=s).prototype=Object.create(o.prototype),n.prototype.constructor=n,n.__proto__=o;var y=s.prototype;return y.handleConnectingAgentAlert=function(t,n){return new Promise(function(r,o){var i,a,s,c;return a=(i=this.props).dispatch,s=l.a.connectingAgentAlertId,c=i.alerts.filter(function(e){return e.id!==s}),t&&c.push({id:s,children:n||e.t("Please, wait for the next available agent.."),warning:!0,hideCloseButton:!0,timeout:0}),Promise.resolve(a({alerts:c})).then(function(){try{return r()}catch(e){return o(e)}},o)}.bind(this))},y.handleQueueMessage=function(e,t){return new Promise(function(n,r){var o,i,a,s,c,u,d,f,m;return t?(o=l.a.livechatQueueMessageId,a=(i=void 0===(i=t.message)?{}:i).text,s=i.user,this.props.room&&e&&a&&this.state.triggerQueueMessage?(this.state.triggerQueueMessage=!1,u=(c=this.props).dispatch,d=c.messages,f=new Date,m={_id:o,msg:a,u:s,ts:f.toISOString()},Promise.resolve(u({messages:Object(h.p)(d,m,function(e){return e._id===m._id},function(e){return e.ts})})).then(function(){try{return n()}catch(e){return r(e)}},r)):n()):n()}.bind(this))},y.componentDidMount=function(){return new Promise(function(e,t){return Promise.resolve(this.checkConnectingAgent()).then(function(){try{return Object(m.e)(),e()}catch(e){return t(e)}},t)}.bind(this))},y.componentWillReceiveProps=function(e){return new Promise(function(t,n){var r,o,i,a,s,c,u,h;if(i=(o=this.props).messages,a=o.alerts,s=o.dispatch,(r=e.messages)&&i&&r.length!==i.length&&e.visible&&!e.minimized){if(u=i[i.length-1],(c=r[r.length-1])&&u&&c._id!==u._id||1===r.length&&0===i.length)return h=a.filter(function(e){return e.id!==l.a.unreadMessagesAlertId}),Promise.resolve(s({alerts:h,unread:null,lastReadMessageId:c._id})).then(function(){try{return d.call(this)}catch(e){return n(e)}}.bind(this),n);function d(){return f.call(this)}return d.call(this)}function f(){return t()}return f.call(this)}.bind(this))},y.componentDidUpdate=function(){return new Promise(function(e,t){return Promise.resolve(this.checkConnectingAgent()).then(function(){try{return this.checkRoom(),e()}catch(e){return t(e)}}.bind(this),t)}.bind(this))},y.componentWillUnmount=function(){this.handleConnectingAgentAlert(!1)},s}(o.Component),C=function(t){var n=t.ref,o=v(t,["ref"]);return r(s.a,null,function(t){var i=t.config,a=i.settings,s=(a=void 0===a?{}:a).fileUpload,c=a.allowSwitchingDepartments,u=a.forceAcceptDataProcessingConsent,l=a.showConnecting,d=i.messages,f=(d=void 0===d?{}:d).conversationFinishedMessage,m=i.theme;m=void 0===m?{}:m;var p=i.departments,v=void 0===p?{}:p,y=t.iframe,b=(y=void 0===y?{}:y).theme,P=(b=void 0===b?{}:b).title,w=y.guest,C=t.token,O=t.agent,S=t.sound,k=t.user,D=t.room,T=t.messages,A=t.noMoreMessages,R=t.typing,U=t.loading,M=t.dispatch,E=t.alerts,F=t.visible,_=t.unread,x=t.lastReadMessageId,I=t.triggerAgent,L=t.queueInfo;return r(j,g({ref:n},o,{theme:{color:b.color||m.color,fontColor:b.fontColor,iconColor:b.iconColor,title:P},title:P||m.title||e.t("Need help?"),sound:S,token:C,user:k,agent:O?{_id:O._id,name:O.name,status:O.status,email:O.emails&&O.emails[0]&&O.emails[0].address,username:O.username,phone:O.phone&&O.phone[0]&&O.phone[0].phoneNumber||O.customFields&&O.customFields.phone,avatar:O.username?{description:O.username,src:Object(h.h)(O.username)}:void 0}:void 0,room:D,messages:T&&T.filter(function(e){return Object(h.c)(e)}),noMoreMessages:A,emoji:!0,uploads:s,typingUsernames:Array.isArray(R)?R:[],loading:U,showConnecting:l,connecting:!(!D||O||!l&&!L),dispatch:M,departments:v,allowSwitchingDepartments:c,conversationFinishedMessage:f||e.t("Conversation finished"),allowRemoveUserData:u,alerts:E,visible:F,unread:_,lastReadMessageId:x,guest:w,triggerAgent:I,queueInfo:L?{spot:L.spot,estimatedWaitTimeSeconds:L.estimatedWaitTimeSeconds,message:L.message}:void 0}))})};t.c=C}).call(this,n("fsQa").default,n("gDde").h)},"t2/N":function(e,t,n){"use strict";n.r(t);var r=n("EZ5h");n.d(t,"Chat",function(){return r.a});var o=n("mvzb");n.d(t,"ChatContainer",function(){return o.b}),n.d(t,"ChatConnector",function(){return o.a}),n.d(t,"default",function(){return o.c})}}]);