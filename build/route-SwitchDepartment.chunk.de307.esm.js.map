{"version":3,"sources":["webpack:///./routes/SwitchDepartment/component.js","webpack:///./routes/SwitchDepartment/container.js","webpack:///./routes/SwitchDepartment/index.js"],"names":["defaultTitle","I18n","t","defaultMessage","SwitchDepartment","props","state","department","validations","Validations","nonEmpty","getValidableFields","Object","keys","map","fieldName","filter","Boolean","validate","name","value","reduce","error","validation","undefined","validateAll","setState","showError","isValid","every","handleFieldChange","target","handleDepartmentChange","handleSubmit","event","preventDefault","onSubmit","values","entries","entry","handleCancelClick","onCancel","departments","length","getDerivedStateFromProps","componentDidMount","this","render","title","color","message","loading","valid","Screen","className","createClassName","styles","Content","Form","label","options","_id","placeholder","disabled","onInput","ButtonGroup","Button","submit","stack","secondary","nude","onClick","Footer","Component","SwitchDepartmentContainer","confirmChangeDepartment","result","ModalManager","confirm","text","success","fields","user","alerts","dispatch","room","token","Livechat","grantVisitor","visitor","push","id","createToken","children","history","go","console","warning","rid","transferChat","loadConfig","alert","handleCancel","SwitchDepartmentConnector","ref","config","theme","iframe","customColor","customFontColor","fontColor","customIconColor","iconColor","dept","showOnRegistration"],"mappings":"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","file":"route-SwitchDepartment.chunk.de307.esm.js","sourcesContent":["import { h, Component } from 'preact';\n\nimport { Button } from '../../components/Button';\nimport { ButtonGroup } from '../../components/ButtonGroup';\nimport { Form, FormField, SelectInput, Validations } from '../../components/Form';\nimport Screen from '../../components/Screen';\nimport { createClassName } from '../../components/helpers';\nimport I18n from '../../i18n';\nimport styles from './styles.scss';\n\n\nconst defaultTitle = I18n.t('Change Department');\nconst defaultMessage = I18n.t('Choose a department');\n\nexport default class SwitchDepartment extends Component {\n\tstatic getDerivedStateFromProps(props, state) {\n\t\tif (props.departments && props.departments.length > 0 && !state.department) {\n\t\t\treturn { department: { value: '' } };\n\t\t}\n\n\t\tif (!props.departments || props.departments.length === 0) {\n\t\t\treturn { department: null };\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tstate = {\n\t\tdepartment: null,\n\t}\n\n\tvalidations = {\n\t\tdepartment: [Validations.nonEmpty],\n\t}\n\n\tgetValidableFields = () => Object.keys(this.validations)\n\t\t.map((fieldName) => (this.state[fieldName] ? { fieldName, ...this.state[fieldName] } : null))\n\t\t.filter(Boolean)\n\n\tvalidate = ({ name, value }) => this.validations[name].reduce((error, validation) => error || validation({ value }), undefined)\n\n\tvalidateAll = () => {\n\t\tfor (const { fieldName: name, value } of this.getValidableFields()) {\n\t\t\tconst error = this.validate({ name, value });\n\t\t\tthis.setState({ [name]: { ...this.state[name], value, error, showError: false } });\n\t\t}\n\t}\n\n\tisValid = () => this.getValidableFields().every(({ error } = {}) => !error)\n\n\thandleFieldChange = (name) => ({ target: { value } }) => {\n\t\tconst error = this.validate({ name, value });\n\t\tthis.setState({ [name]: { ...this.state[name], value, error, showError: false } });\n\t\tthis.validateAll();\n\t}\n\n\thandleDepartmentChange = this.handleFieldChange('department')\n\n\thandleSubmit = (event) => {\n\t\tevent.preventDefault();\n\n\t\tif (this.props.onSubmit) {\n\t\t\tconst values = Object.entries(this.state)\n\t\t\t\t.filter(([, state]) => state !== null)\n\t\t\t\t.map(([name, { value }]) => ({ [name]: value }))\n\t\t\t\t.reduce((values, entry) => ({ ...values, ...entry }), {});\n\t\t\tthis.props.onSubmit(values);\n\t\t}\n\t}\n\n\thandleCancelClick = () => {\n\t\tconst { onCancel } = this.props;\n\t\tonCancel && onCancel();\n\t}\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tconst { departments } = props;\n\t\tif (departments && departments.length > 0) {\n\t\t\tthis.state.department = { value: '' };\n\t\t}\n\t}\n\n\tcomponentDidMount() {\n\t\tthis.validateAll();\n\t}\n\n\trender({ title, color, message, loading, departments, ...props }, { department }) {\n\t\tconst valid = this.isValid();\n\t\treturn (\n\t\t\t<Screen\n\t\t\t\tcolor={color}\n\t\t\t\ttitle={title || defaultTitle}\n\t\t\t\tclassName={createClassName(styles, 'switch-department')}\n\t\t\t\t{...props}\n\t\t\t>\n\t\t\t\t<Screen.Content>\n\t\t\t\t\t<p className={createClassName(styles, 'switch-department__message')}>{message || defaultMessage}</p>\n\n\t\t\t\t\t<Form onSubmit={this.handleSubmit}>\n\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\tlabel={I18n.t('Departments')}\n\t\t\t\t\t\t\terror={department && department.showError && department.error}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\t\tname='department'\n\t\t\t\t\t\t\t\tvalue={department && department.value}\n\t\t\t\t\t\t\t\toptions={departments.map(({ _id, name }) => ({ value: _id, label: name }))}\n\t\t\t\t\t\t\t\tplaceholder={I18n.t('Choose a department...')}\n\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t\terror={department && department.showError}\n\t\t\t\t\t\t\t\tonInput={this.handleDepartmentChange}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</FormField>\n\n\t\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t\t<Button submit loading={loading} disabled={!valid || loading} stack>{I18n.t('Start chat')}</Button>\n\t\t\t\t\t\t\t<Button disabled={loading} stack secondary nude onClick={this.handleCancelClick}>{I18n.t('Cancel')}</Button>\n\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t</Form>\n\t\t\t\t</Screen.Content>\n\t\t\t\t<Screen.Footer />\n\t\t\t</Screen>\n\t\t);\n\t}\n}\n","import { h, Component } from 'preact';\n\nimport { Livechat } from '../../api';\nimport { ModalManager } from '../../components/Modal';\nimport { createToken } from '../../components/helpers';\nimport history from '../../history';\nimport I18n from '../../i18n';\nimport { loadConfig } from '../../lib/main';\nimport { Consumer } from '../../store';\nimport SwitchDepartment from './component';\n\nexport class SwitchDepartmentContainer extends Component {\n\tconfirmChangeDepartment = async () => {\n\t\tconst result = await ModalManager.confirm({\n\t\t\ttext: I18n.t('Are you sure you want to switch the department?'),\n\t\t});\n\n\t\treturn typeof result.success === 'boolean' && result.success;\n\t}\n\n\thandleSubmit = async (fields) => {\n\t\tconst { alerts, dispatch, room, token } = this.props;\n\t\tconst { department } = fields;\n\n\t\tconst confirm = await this.confirmChangeDepartment();\n\t\tif (!confirm) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!room) {\n\t\t\tconst user = await Livechat.grantVisitor({ visitor: { department, token } });\n\t\t\tawait dispatch({ user, alerts: (alerts.push({ id: createToken(), children: I18n.t('Department switched'), success: true }), alerts) });\n\t\t\treturn history.go(-1);\n\t\t}\n\n\t\tawait dispatch({ loading: true });\n\t\ttry {\n\t\t\tconst { _id: rid } = room;\n\t\t\tconst result = await Livechat.transferChat({ rid, department });\n\t\t\tconst { success } = result;\n\t\t\tif (!success) {\n\t\t\t\tthrow I18n.t('No available agents to transfer');\n\t\t\t}\n\n\t\t\tawait dispatch({ department, loading: false });\n\t\t\tawait loadConfig();\n\n\t\t\tawait ModalManager.alert({\n\t\t\t\ttext: I18n.t('Department switched'),\n\t\t\t});\n\n\t\t\thistory.go(-1);\n\t\t} catch (error) {\n\t\t\tconsole.error(error);\n\t\t\tawait dispatch({ alerts: (alerts.push({ id: createToken(), children: I18n.t('No available agents to transfer'), warning: true }), alerts) });\n\t\t} finally {\n\t\t\tawait dispatch({ loading: false });\n\t\t}\n\t}\n\n\thandleCancel = () => {\n\t\thistory.go(-1);\n\t}\n\n\trender = (props) => (\n\t\t<SwitchDepartment {...props} onSubmit={this.handleSubmit} onCancel={this.handleCancel} />\n\t)\n}\n\nexport const SwitchDepartmentConnector = ({ ref, ...props }) => (\n\t<Consumer>\n\t\t{({\n\t\t\tconfig: {\n\t\t\t\tdepartments = {},\n\t\t\t\ttheme: {\n\t\t\t\t\tcolor,\n\t\t\t\t} = {},\n\t\t\t} = {},\n\t\t\tiframe: {\n\t\t\t\ttheme: {\n\t\t\t\t\tcolor: customColor,\n\t\t\t\t\tfontColor: customFontColor,\n\t\t\t\t\ticonColor: customIconColor,\n\t\t\t\t} = {},\n\t\t\t} = {},\n\t\t\troom,\n\t\t\tloading = false,\n\t\t\tdepartment,\n\t\t\tdispatch,\n\t\t\talerts,\n\t\t\ttoken,\n\t\t}) => (\n\t\t\t<SwitchDepartmentContainer\n\t\t\t\tref={ref}\n\t\t\t\t{...props}\n\t\t\t\ttheme={{\n\t\t\t\t\tcolor: customColor || color,\n\t\t\t\t\tfontColor: customFontColor,\n\t\t\t\t\ticonColor: customIconColor,\n\t\t\t\t}}\n\t\t\t\tloading={loading}\n\t\t\t\tdepartments={departments.filter((dept) => dept.showOnRegistration && dept._id !== department)}\n\t\t\t\tdispatch={dispatch}\n\t\t\t\troom={room}\n\t\t\t\talerts={alerts}\n\t\t\t\ttoken={token}\n\t\t\t/>\n\t\t)}\n\t</Consumer>\n);\n\n\nexport default SwitchDepartmentConnector;\n","export { default as SwitchDepartment } from './component';\nexport { SwitchDepartmentContainer, SwitchDepartmentConnector } from './container';\nexport { default } from './container';\n"],"sourceRoot":""}