{"version":3,"sources":["webpack:///./routes/Register/component.js","webpack:///./routes/Register/container.js","webpack:///./routes/Register/index.js"],"names":["defaultTitle","I18n","t","defaultMessage","getDefaultDepartment","departments","length","_id","validations","name","Validations","nonEmpty","email","department","getValidableFields","state","Object","keys","map","fieldName","filter","Boolean","validate","props","value","pattern","regexp","customFields","required","push","custom","reduce","values","entry","error","validation","undefined","getDefaultState","hasNameField","hasEmailField","hasDepartmentField","forEach","defaultValue","options","Array","isArray","includes","showError","Register","handleFieldChange","target","setState","handleSubmit","event","preventDefault","onSubmit","entries","getDerivedStateFromProps","nextProps","departmentDefault","nameDefault","emailDefault","nameValue","emailValue","departmentValue","showDepartmentField","render","title","color","message","loading","valid","this","every","Screen","className","createClassName","styles","Content","Form","label","placeholder","field","disabled","onInput","sortArrayByColumn","type","key","option","renderCustomFields","ButtonGroup","Button","submit","stack","Footer","Component","RegisterContainer","getDepartment","deptDefault","find","dept","showOnRegistration","fields","user","dispatch","token","Livechat","grantVisitor","visitor","parentCall","registerCustomFields","getDepartmentDefault","CustomFields","setCustomField","guestDepartment","some","componentDidUpdate","prevProps","prevUser","route","RegisterConnector","ref","config","messages","registrationFormMessage","settings","nameFieldRegistrationForm","emailFieldRegistrationForm","theme","iframe","guest","guestName","guestEmail","customColor","customFontColor","fontColor","customIconColor","iconColor","customTitle"],"mappings":"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","file":"route-Register.chunk.d3e3e.esm.js","sourcesContent":["import { h, Component } from 'preact';\n\nimport { Button } from '../../components/Button';\nimport { ButtonGroup } from '../../components/ButtonGroup';\nimport {\n\tForm,\n\tFormField,\n\tTextInput,\n\tSelectInput,\n\tValidations,\n} from '../../components/Form';\nimport Screen from '../../components/Screen';\nimport { createClassName, sortArrayByColumn } from '../../components/helpers';\nimport I18n from '../../i18n';\nimport styles from './styles.scss';\n\nconst defaultTitle = I18n.t('Need help?');\nconst defaultMessage = I18n.t('Please, tell us some information to start the chat');\n\nconst getDefaultDepartment = (departments = []) => (departments.length === 1 && departments[0]._id) || '';\n\nconst renderCustomFields = (customFields, { loading, handleFieldChange = () => {} }, state) => customFields.map(({ _id, required, label, type, options }) => {\n\tswitch (type) {\n\t\tcase 'input':\n\t\t\treturn <FormField\n\t\t\t\tlabel={label}\n\t\t\t\trequired={required}\n\t\t\t\tkey={_id}\n\t\t\t\terror={state[_id].showError && state[_id].error}\n\t\t\t>\n\t\t\t\t<TextInput\n\t\t\t\t\tname={_id}\n\t\t\t\t\tplaceholder={I18n.t('Insert your %{field} here...', { field: label })}\n\t\t\t\t\tvalue={state[_id].value}\n\t\t\t\t\tdisabled={loading}\n\t\t\t\t\tonInput={handleFieldChange}\n\t\t\t\t\tcustom\n\t\t\t\t/>\n\t\t\t</FormField>;\n\t\tcase 'select':\n\t\t\treturn <FormField\n\t\t\t\tlabel={label}\n\t\t\t\trequired={required}\n\t\t\t\tkey={_id}\n\t\t\t\terror={state[_id].showError && state[_id].error}\n\t\t\t>\n\t\t\t\t<SelectInput\n\t\t\t\t\tname={_id}\n\t\t\t\t\tvalue={state[_id].value}\n\t\t\t\t\tplaceholder={I18n.t('Choose an option...')}\n\t\t\t\t\toptions={options && options.map((option) => ({ value: option, label: option }))}\n\t\t\t\t\tdisabled={loading}\n\t\t\t\t\tonInput={handleFieldChange}\n\t\t\t\t\tcustom\n\t\t\t\t/>\n\t\t\t</FormField>;\n\t}\n\treturn null;\n});\n\nconst validations = {\n\tname: [Validations.nonEmpty],\n\temail: [Validations.nonEmpty, Validations.email],\n\tdepartment: [],\n};\n\nconst getCustomValidations = ({ customFields = [] }) =>\n\tcustomFields\n\t\t.map(({ _id, required, regexp }) => {\n\t\t\tconst validations = [];\n\n\t\t\tif (required) {\n\t\t\t\tvalidations.push(Validations.nonEmpty);\n\t\t\t}\n\n\t\t\tif (regexp) {\n\t\t\t\tvalidations.push(Validations.custom);\n\t\t\t}\n\n\t\t\treturn { [_id]: validations };\n\t\t})\n\t\t.reduce((values, entry) => ({ ...values, ...entry }), {});\n\nconst getValidableFields = (state) =>\n\tObject.keys(validations)\n\t\t.map((fieldName) => (state[fieldName] ? { fieldName, ...state[fieldName] } : null))\n\t\t.filter(Boolean);\n\nconst validate = (props, { name, value, regexp: pattern }) => {\n\tconst validation = validations[name] || getCustomValidations(props)[name];\n\treturn validation.reduce((error, validation) => error || validation({ value, pattern }), undefined);\n};\n\nconst getDefaultState = (props) => {\n\tconst { hasNameField, hasEmailField, hasDepartmentField, departments, customFields = [] } = props;\n\n\tlet state = {\n\t\t...hasNameField && { name: { value: '' } },\n\t\t...hasEmailField && { email: { value: '' } },\n\t\t...hasDepartmentField && { department: { value: getDefaultDepartment(departments) } },\n\t};\n\n\tcustomFields.forEach(({ _id, defaultValue, options, regexp }) => {\n\t\tlet value = '';\n\t\tif ((defaultValue && !options) || (Array.isArray(options) && options.includes(defaultValue))) {\n\t\t\tvalue = defaultValue;\n\t\t}\n\n\t\tstate[_id] = {\n\t\t\tvalue,\n\t\t\t...regexp && { regexp },\n\t\t};\n\t});\n\n\tfor (const { fieldName: name, value, regexp } of getValidableFields(state)) {\n\t\tconst error = validate(props, { name, value, regexp });\n\t\tstate = {\n\t\t\t...state,\n\t\t\t[name]: {\n\t\t\t\t...state[name],\n\t\t\t\tvalue,\n\t\t\t\terror,\n\t\t\t\tshowError: false,\n\t\t\t},\n\t\t};\n\t}\n\n\treturn state;\n};\n\nexport default class Register extends Component {\n\tstatic getDerivedStateFromProps(nextProps, state) {\n\t\tconst { hasNameField, hasEmailField, hasDepartmentField, departmentDefault, departments, nameDefault, emailDefault } = nextProps;\n\n\t\tconst nameValue = nameDefault || '';\n\t\tif (hasNameField && (!state.name || state.name !== nameValue)) {\n\t\t\tstate = { ...state, name: { ...state.name, value: nameValue } };\n\t\t} else if (!hasNameField) {\n\t\t\tstate = { ...state, name: null };\n\t\t}\n\n\t\tconst emailValue = emailDefault || '';\n\t\tif (hasEmailField && (!state.email || state.name !== emailValue)) {\n\t\t\tstate = { ...state, email: { ...state.email, value: emailValue } };\n\t\t} else if (!hasEmailField) {\n\t\t\tstate = { ...state, email: null };\n\t\t}\n\n\t\tconst departmentValue = departmentDefault || getDefaultDepartment(departments);\n\t\tconst showDepartmentField = hasDepartmentField && departments && departments.length > 1;\n\t\tif (showDepartmentField && (!state.department || state.department !== departmentValue)) {\n\t\t\tstate = { ...state, department: { ...state.department, value: departmentValue } };\n\t\t} else if (!showDepartmentField) {\n\t\t\tstate = { ...state, department: null };\n\t\t}\n\n\t\tfor (const { fieldName: name, value, regexp } of getValidableFields(state)) {\n\t\t\tconst error = validate(nextProps, { name, value, regexp });\n\t\t\tstate = { ...state, [name]: { ...state[name], value, error, showError: false } };\n\t\t}\n\t}\n\n\tstate = {\n\t\tname: null,\n\t\temail: null,\n\t\tdepartment: null,\n\t}\n\n\thandleFieldChange = ({ target }) => {\n\t\tconst { name, value } = target;\n\t\tconst { regexp } = this.state[name];\n\t\tconst error = validate(this.props, { name, value, regexp });\n\t\tthis.setState({\n\t\t\t[name]: {\n\t\t\t\t...this.state[name],\n\t\t\t\tvalue,\n\t\t\t\terror,\n\t\t\t\tshowError: true,\n\t\t\t},\n\t\t});\n\t}\n\n\thandleSubmit = (event) => {\n\t\tevent.preventDefault();\n\n\t\tif (this.props.onSubmit) {\n\t\t\tconst values = Object.entries(this.state)\n\t\t\t\t.filter(([, state]) => state !== null)\n\t\t\t\t.map(([name, { value }]) => ({ [name]: value }))\n\t\t\t\t.reduce((values, entry) => ({ ...values, ...entry }), {});\n\t\t\tthis.props.onSubmit(values);\n\t\t}\n\t}\n\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis.state = getDefaultState(props);\n\t}\n\n\trender({ title, color, message, loading, departments, customFields, ...props }, { name, email, department, ...state }) {\n\t\tconst valid = getValidableFields(this.state).every(({ error } = {}) => !error);\n\n\t\treturn (\n\t\t\t<Screen\n\t\t\t\tcolor={color}\n\t\t\t\ttitle={title || defaultTitle}\n\t\t\t\tclassName={createClassName(styles, 'register')}\n\t\t\t\t{...props}\n\t\t\t>\n\t\t\t\t<Screen.Content>\n\t\t\t\t\t<p className={createClassName(styles, 'register__message')}>{message || defaultMessage}</p>\n\n\t\t\t\t\t<Form onSubmit={this.handleSubmit}>\n\t\t\t\t\t\t{name\n\t\t\t\t\t\t\t? (\n\t\t\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tlabel={I18n.t('Name')}\n\t\t\t\t\t\t\t\t\terror={name.showError && name.error}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t\tname='name'\n\t\t\t\t\t\t\t\t\t\tvalue={name.value}\n\t\t\t\t\t\t\t\t\t\tplaceholder={I18n.t('Insert your %{field} here...', { field: I18n.t('Name') })}\n\t\t\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t\t\t\tonInput={this.handleFieldChange}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FormField>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: null}\n\n\t\t\t\t\t\t{email\n\t\t\t\t\t\t\t? (\n\t\t\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\t\t\trequired\n\t\t\t\t\t\t\t\t\tlabel={I18n.t('Email')}\n\t\t\t\t\t\t\t\t\terror={email.showError && email.error}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<TextInput\n\t\t\t\t\t\t\t\t\t\tname='email'\n\t\t\t\t\t\t\t\t\t\tvalue={email.value}\n\t\t\t\t\t\t\t\t\t\tplaceholder={I18n.t('Insert your %{field} here...', { field: I18n.t('Email') })}\n\t\t\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t\t\t\tonInput={this.handleFieldChange}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FormField>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: null}\n\n\t\t\t\t\t\t{department\n\t\t\t\t\t\t\t? (\n\t\t\t\t\t\t\t\t<FormField\n\t\t\t\t\t\t\t\t\tlabel={I18n.t('I need help with...')}\n\t\t\t\t\t\t\t\t\terror={department.showError && department.error}\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t<SelectInput\n\t\t\t\t\t\t\t\t\t\tname='department'\n\t\t\t\t\t\t\t\t\t\tvalue={department.value}\n\t\t\t\t\t\t\t\t\t\toptions={sortArrayByColumn(departments, 'name').map(({ _id, name }) => ({ value: _id, label: name }))}\n\t\t\t\t\t\t\t\t\t\tplaceholder={I18n.t('Choose an option...')}\n\t\t\t\t\t\t\t\t\t\tdisabled={loading}\n\t\t\t\t\t\t\t\t\t\tonInput={this.handleFieldChange}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</FormField>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: null}\n\n\t\t\t\t\t\t{customFields && renderCustomFields(customFields, { loading, handleFieldChange: this.handleFieldChange }, state)}\n\n\t\t\t\t\t\t<ButtonGroup>\n\t\t\t\t\t\t\t<Button submit loading={loading} disabled={!valid || loading} stack>{I18n.t('Start chat')}</Button>\n\t\t\t\t\t\t</ButtonGroup>\n\t\t\t\t\t</Form>\n\t\t\t\t</Screen.Content>\n\t\t\t\t<Screen.Footer />\n\t\t\t</Screen>\n\t\t);\n\t}\n}\n","import { h, Component } from 'preact';\nimport { route } from 'preact-router';\n\nimport { Livechat } from '../../api';\nimport CustomFields from '../../lib/customFields';\nimport { parentCall } from '../../lib/parentCall';\nimport { Consumer } from '../../store';\nimport Register from './component';\n\nexport class RegisterContainer extends Component {\n\tregisterCustomFields(customFields = {}) {\n\t\tObject.entries(customFields).forEach(([key, value]) => {\n\t\t\tif (!value || value === '') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tCustomFields.setCustomField(key, value, true);\n\t\t});\n\t}\n\n\tgetDepartment = (department) => {\n\t\tif (department !== '') {\n\t\t\treturn department;\n\t\t}\n\n\t\tconst { departments = {} } = this.props;\n\t\tconst deptDefault = departments.find((dept) => dept.showOnRegistration);\n\n\t\tif (deptDefault) {\n\t\t\treturn deptDefault._id;\n\t\t}\n\t}\n\n\thandleSubmit = async ({ name, email, department, ...customFields }) => {\n\t\tconst { dispatch, token } = this.props;\n\t\tconst fields = {\n\t\t\tname,\n\t\t\temail,\n\t\t\tdepartment: this.getDepartment(department),\n\t\t};\n\n\t\tawait dispatch({ loading: true, department });\n\t\ttry {\n\t\t\tconst user = await Livechat.grantVisitor({ visitor: { ...fields, token } });\n\t\t\tawait dispatch({ user });\n\t\t\tparentCall('callback', ['pre-chat-form-submit', fields]);\n\t\t\tthis.registerCustomFields(customFields);\n\t\t} finally {\n\t\t\tawait dispatch({ loading: false });\n\t\t}\n\t}\n\n\tgetDepartmentDefault() {\n\t\tconst { guestDepartment, departments } = this.props;\n\t\tif (departments && departments.some((dept) => dept._id === guestDepartment)) {\n\t\t\treturn guestDepartment;\n\t\t}\n\t}\n\n\tcomponentDidUpdate(prevProps) {\n\t\tconst { user: prevUser } = prevProps;\n\t\tconst { user } = this.props;\n\n\t\tif (!prevUser && user && user._id) {\n\t\t\troute('/');\n\t\t}\n\t}\n\n\trender = (props) => (\n\t\t<Register {...props} onSubmit={this.handleSubmit} departmentDefault={this.getDepartmentDefault()} />\n\t)\n}\n\nexport const RegisterConnector = ({ ref, ...props }) => (\n\t<Consumer>\n\t\t{({\n\t\t\tconfig: {\n\t\t\t\tdepartments = {},\n\t\t\t\tmessages: {\n\t\t\t\t\tregistrationFormMessage: message,\n\t\t\t\t} = {},\n\t\t\t\tsettings: {\n\t\t\t\t\tnameFieldRegistrationForm: hasNameField,\n\t\t\t\t\temailFieldRegistrationForm: hasEmailField,\n\t\t\t\t} = {},\n\t\t\t\ttheme: {\n\t\t\t\t\ttitle,\n\t\t\t\t\tcolor,\n\t\t\t\t} = {},\n\t\t\t\tcustomFields = [],\n\t\t\t} = {},\n\t\t\tiframe: {\n\t\t\t\tguest: {\n\t\t\t\t\tdepartment: guestDepartment,\n\t\t\t\t\tname: guestName,\n\t\t\t\t\temail: guestEmail,\n\t\t\t\t} = {},\n\t\t\t\ttheme: {\n\t\t\t\t\tcolor: customColor,\n\t\t\t\t\tfontColor: customFontColor,\n\t\t\t\t\ticonColor: customIconColor,\n\t\t\t\t\ttitle: customTitle,\n\t\t\t\t} = {},\n\t\t\t} = {},\n\t\t\tloading = false,\n\t\t\ttoken,\n\t\t\tdispatch,\n\t\t\tuser,\n\t\t}) => (\n\t\t\t<RegisterContainer\n\t\t\t\tref={ref}\n\t\t\t\t{...props}\n\t\t\t\ttheme={{\n\t\t\t\t\tcolor: customColor || color,\n\t\t\t\t\tfontColor: customFontColor,\n\t\t\t\t\ticonColor: customIconColor,\n\t\t\t\t\ttitle: customTitle,\n\t\t\t\t}}\n\t\t\t\ttitle={customTitle || title}\n\t\t\t\tmessage={message}\n\t\t\t\thasNameField={hasNameField}\n\t\t\t\thasEmailField={hasEmailField}\n\t\t\t\thasDepartmentField={departments && departments.some((dept) => dept.showOnRegistration)}\n\t\t\t\tdepartments={departments.filter((dept) => dept.showOnRegistration)}\n\t\t\t\tnameDefault={guestName}\n\t\t\t\temailDefault={guestEmail}\n\t\t\t\tguestDepartment={guestDepartment}\n\t\t\t\tloading={loading}\n\t\t\t\ttoken={token}\n\t\t\t\tdispatch={dispatch}\n\t\t\t\tuser={user}\n\t\t\t\tcustomFields={customFields}\n\t\t\t/>\n\t\t)}\n\t</Consumer>\n);\n\n\nexport default RegisterConnector;\n","export { default as Register } from './component';\nexport { RegisterContainer, RegisterConnector } from './container';\nexport { default } from './container';\n"],"sourceRoot":""}